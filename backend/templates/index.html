<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Whisper ìë§‰ ìƒì„±ê¸°</title>
    <link rel="stylesheet" href="/static/style.css">
    <style>
        /* í‘œ ê°„ê²© ë° ì»¬ëŸ¼ë³„ ë„ˆë¹„ ì¡°ì • */
        table th, table td { padding: 6px 8px; }
        th, td { vertical-align: middle; }
        th.status, td.status { min-width: 60px; max-width: 80px; text-align: center; }
        th.progress, td.progress { min-width: 70px; max-width: 90px; text-align: center; }
        th.lang-code, td.lang-code { min-width: 40px; max-width: 50px; text-align: center; }
        th.subtitle-preview, td.subtitle-preview { min-width: 200px; max-width: 600px; }
        td.subtitle-preview { cursor: pointer; }
        .modal-content pre { max-height: 400px; overflow-y: auto; background: #f8f8f8; padding: 10px; border-radius: 4px; }
        .job-btn {
            background: none;
            border: none;
            padding: 2px 2px;
            font-size: 1.15em;
            cursor: pointer;
            margin-right: 2px;
            line-height: 1;
            border-radius: 4px;
            transition: background 0.15s;
        }
        .job-btn:last-child { margin-right: 0; }
        .job-btn:hover {
            background: #f0f2f5;
        }
        #job-list li {
            min-height: 28px;
            font-size: 0.97em;
        }
    </style>
</head>
<body>
    <h1 id="app-title" style="cursor:pointer;">Whisper ìë§‰ ìƒì„±ê¸°</h1>

    <div class="container">
        <!-- [íƒìƒ‰ê¸° ì˜ì—­ ì‹œì‘] -->
        <div id="directory-browser" class="directory-browser">
            <h2>íƒìƒ‰ê¸°</h2>
            <div id="current-path-display">í˜„ì¬ ê²½ë¡œ: /{{ initial_path }}</div>
            <!-- ë””ë ‰í† ë¦¬ íŠ¸ë¦¬ í‘œì‹œ ì˜ì—­ -->
            <ul id="directory-list">
                <li>ë¡œë”© ì¤‘...</li>
            </ul>
            <div class="directory-actions">
                <label for="subtitle-filter">ìë§‰ í•„í„°:</label>
                <select id="subtitle-filter">
                    <option value="all">ì „ì²´</option>
                    <option value="no_subtitle" selected>ìë§‰ì—†ëŠ” ë¯¸ë””ì–´ë§Œ</option>
                    <option value="has_subtitle">ìë§‰ìˆëŠ” ë¯¸ë””ì–´ë§Œ</option>
                </select>
                <button id="scan-directory" class="scan-button">í˜„ì¬ í´ë” ê²€ìƒ‰</button>
            </div>
            <!-- ì‘ì—… í˜„í™© íŒ¨ë„ ì‹œì‘ -->
            <div id="job-status-panel" class="job-status-panel" style="margin-top:18px;padding:12px;background:#f6fafd;border-radius:8px;border:1px solid #e0e6ef;">
                <h3 style="margin:0 0 8px 0;font-size:1.05em;">ì‘ì—… í˜„í™©</h3>
                <ul id="job-list" style="list-style:none;padding:0;margin:0;min-height:32px;">
                    <li style="color:#888;">ì§„í–‰ ì¤‘ì¸ ì‘ì—…ì´ ì—†ìŠµë‹ˆë‹¤.</li>
                </ul>
            </div>
            <!-- ì‘ì—… í˜„í™© íŒ¨ë„ ë -->
        </div>
        <!-- [íƒìƒ‰ê¸° ì˜ì—­ ë] -->

        <!-- [íŒŒì¼ ëª©ë¡ ì˜ì—­ ì‹œì‘] -->
        <div id="file-list-container" class="file-list-container">
            <h2 id="file-list-header">ìë§‰ ì—†ëŠ” ë¯¸ë””ì–´ íŒŒì¼ ëª©ë¡ (/{{ initial_path }})</h2>
            <div class="controls" id="controls">
                <!-- ê²€ìƒ‰ í•„í„° ì¶”ê°€ -->
                <div class="search-filter">
                    <input type="text" id="file-search" placeholder="íŒŒì¼ëª… ê²€ìƒ‰..." class="search-input">
                </div>
                
                <!-- ê¸°ì¡´ í•„í„° -->
                <div class="filters" id="filters">
                    <label><input type="checkbox" id="filter-video" onchange="filterTableClientSide()" {{ "checked" if filter_video else "" }}> ì˜ìƒ</label>
                    <label><input type="checkbox" id="filter-audio" onchange="filterTableClientSide()" {{ "checked" if filter_audio else "" }}> ì˜¤ë””ì˜¤</label>
                </div>
                
                <div class="actions" id="actions">
                     <label for="model-select">ëª¨ë¸:</label>
                     <select id="model-select">
                         <option value="tiny">Tiny</option>
                         <option value="base" selected>Base</option>
                         <option value="small">Small</option>
                         <option value="medium">Medium</option>
                         <!-- Large ëª¨ë¸ì€ ë¦¬ì†ŒìŠ¤ ë§ì´ í•„ìš” -->
                         <!-- <option value="large">Large</option> -->
                     </select>
                    <label for="whisper-lang">ì–¸ì–´:</label>
                    <select id="whisper-lang">
                        <option value="auto" selected>ìë™ ì¸ì‹</option>
                        <option value="en">ì˜ì–´ (en)</option>
                        <option value="ko">í•œêµ­ì–´ (ko)</option>
                        <option value="jp">ì¼ë³¸ì–´ (jp)</option>
                        <option value="cn">ì¤‘êµ­ì–´ (cn)</option>
                        <option value="fr">í”„ë‘ìŠ¤ì–´ (fr)</option>
                    </select>
                    <button id="select-all">ì „ì²´ ì„ íƒ</button>
                    <button id="deselect-all">ì „ì²´ í•´ì œ</button>
                    <button id="run-whisper" class="cta-button">ì„ íƒ íŒŒì¼ ìë§‰ ìƒì„±</button>
                    <button id="stop-whisper" class="stop-button" style="display: none;">ì²˜ë¦¬ ì¤‘ì§€</button>
                </div>
            </div>

             <div class="table-wrapper" id="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th><input type="checkbox" id="select-all-header"></th>
                            <th class="status">ìƒíƒœ</th>
                            <th class="progress">ì§„í–‰ë¥ </th>
                            <th>íŒŒì¼ ì´ë¦„</th>
                            <th class="lang-code">ì–¸ì–´</th>
                            <th class="subtitle-preview">ìë§‰ ë¯¸ë¦¬ë³´ê¸°</th>
                        </tr>
                    </thead>
                    <tbody id="file-list">
                        <tr><td colspan="5">íŒŒì¼ ëª©ë¡ ë¡œë”© ì¤‘...</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- [ì™„ë£Œëœ íŒŒì¼ ì˜ì—­ ì‹œì‘] -->
            <div id="completed-list" class="completed-list">
                <h3>ì™„ë£Œëœ íŒŒì¼</h3>
                <ul id="completed-files">
                    <!-- ì™„ë£Œëœ íŒŒì¼ ëª©ë¡ (ë‹¤ìš´ë¡œë“œ ë§í¬ í¬í•¨) -->
                </ul>
            </div>
            <!-- [ì™„ë£Œëœ íŒŒì¼ ì˜ì—­ ë] -->

            <!-- [ë°°ì¹˜ ìƒíƒœ ì˜ì—­ ì‹œì‘] -->
            <div id="batch-status" class="batch-status">
                 <!-- ë°°ì¹˜ ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ -->
            </div>
            <!-- [ë°°ì¹˜ ìƒíƒœ ì˜ì—­ ë] -->
        </div>
        <!-- [íŒŒì¼ ëª©ë¡ ì˜ì—­ ë] -->
    </div>

    <!-- [ì§„í–‰ë¥  ëª¨ë‹¬ì°½ ì˜ì—­ ì‹œì‘] -->
    <div id="progress-modal" class="modal" style="display:none;">
        <div class="modal-content">
            <span class="close" id="modal-close">&times;</span>
            <h3>ì§„í–‰ ìƒì„¸ ì •ë³´</h3>
            <div id="modal-file-path"></div>
            <div id="modal-progress-log">(ì§„í–‰ìƒíƒœ/ë¡œê·¸ í‘œì‹œ ì˜ˆì •)</div>
        </div>
    </div>
    <!-- [ì§„í–‰ë¥  ëª¨ë‹¬ì°½ ì˜ì—­ ë] -->

    <script>
        // ìƒìˆ˜ ë° ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
        const clientId = "{{ client_id }}";
        let websocket;
        let isProcessing = false;
        let currentRelativePath = "{{ initial_path }}";
        
        // íŒŒì¼ ê²½ë¡œ ê´€ë ¨ ìœ í‹¸ë¦¬í‹°
        const Path = {
            basename: function(path) {
                return path.split(/[\\/]/).pop();
            },
            dirname: function(path) {
                return path.split(/[\\/]/).slice(0, -1).join('/');
            },
            join: function(...parts) {
                return parts.filter(part => part && part !== '').join('/');
            }
        };

        // í…ìŠ¤íŠ¸ ì´ìŠ¤ì¼€ì´í”„ í•¨ìˆ˜
        function escapeHtml(unsafe) {
            if (!unsafe) return '';
            return unsafe
                 .replace(/&/g, "&amp;")
                 .replace(/</g, "&lt;")
                 .replace(/>/g, "&gt;")
                 .replace(/"/g, "&quot;")
                 .replace(/'/g, "&#039;");
        }
        
        // WebSocket ê´€ë ¨ í•¨ìˆ˜
        function connectWebSocket() {
            const wsUrl = `ws://${window.location.host}/ws/${clientId}`;
            console.log("WebSocket ì—°ê²° ì‹œë„:", wsUrl);
            
            // ê¸°ì¡´ ì—°ê²° ë‹«ê¸°
            if (websocket && websocket.readyState !== WebSocket.CLOSED) {
                websocket.close();
            }
            
            websocket = new WebSocket(wsUrl);

            websocket.onopen = (event) => {
                console.log("WebSocket ì—°ê²° ì„±ê³µ");
            };

            websocket.onmessage = (event) => {
                handleWebSocketMessage(event.data);
            };

            websocket.onclose = (event) => {
                console.log("WebSocket ì—°ê²° ëŠê¹€. ì½”ë“œ:", event.code, "ì´ìœ :", event.reason);
                isProcessing = false;
                updateUIState();
                
                // 10ì´ˆ í›„ ì¬ì—°ê²° ì‹œë„ (ì„œë²„ê°€ ì¬ì‹œì‘ë  ê²½ìš°)
                setTimeout(() => {
                    if (!isProcessing) {
                        console.log("WebSocket ì¬ì—°ê²° ì‹œë„...");
                        connectWebSocket();
                    }
                }, 10000);
            };

            websocket.onerror = (error) => {
                console.error("WebSocket ì˜¤ë¥˜ ë°œìƒ:", error);
                isProcessing = false;
                updateUIState();
            };
        }

        function handleWebSocketMessage(message) {
            try {
                const data = JSON.parse(message);
                console.log("WebSocket ë©”ì‹œì§€ ìˆ˜ì‹ :", data);

                const fileRow = findRowByPath(data.file_path);

                if (data.type === "status_update") {
                    if (fileRow) {
                        const statusCell = fileRow.querySelector(".status");
                        const progressCell = fileRow.querySelector(".progress");
                        const subtitleCell = fileRow.querySelector(".subtitle-preview");
                        const checkbox = fileRow.querySelector(".file-checkbox");

                        statusCell.textContent = data.message;
                        progressCell.textContent = data.status;
                        fileRow.className = `status-${data.status}`;

                        if (data.status === "completed") {
                             statusCell.innerHTML = `<a href="/download?file_path=${encodeURIComponent(data.output_path)}" target="_blank">ë‹¤ìš´ë¡œë“œ</a>`;
                            if (data.subtitle_preview) {
                                subtitleCell.innerHTML = `<pre>${escapeHtml(data.subtitle_preview)}</pre>`;
                            }
                            checkbox.checked = false;
                            checkbox.disabled = true;
                        } else if (data.status === "skipped" || data.status === "error" || data.status === "cancelled") {
                            checkbox.checked = false;
                            checkbox.disabled = true;
                        } else {
                            checkbox.disabled = true;
                            subtitleCell.textContent = '-';
                        }

                        // ì§„í–‰ë¥  bar ìƒì„± ë° ê°±ì‹ 
                        let progressBar = progressCell.querySelector('.progress-bar');
                        if (!progressBar) {
                            progressCell.innerHTML = `<div class="progress-bar-container"><div class="progress-bar" style="width:0%"></div></div>`;
                            progressBar = progressCell.querySelector('.progress-bar');
                            // í´ë¦­ ì´ë²¤íŠ¸(ëª¨ë‹¬)
                            progressBar.parentElement.onclick = () => {
                                showProgressModal(data.file_path);
                            };
                        }
                        // ì§„í–‰ë¥ (%) ì ìš© (data.progress_percentê°€ ìˆìœ¼ë©´)
                        if (typeof data.progress_percent === 'number') {
                            progressBar.style.width = `${data.progress_percent}%`;
                            progressBar.textContent = `${data.progress_percent}%`;
                        } else {
                            progressBar.style.width = '0%';
                            progressBar.textContent = '';
                        }
                    } else {
                        console.warn("Status update for unknown file path:", data.file_path);
                    }
                } else if (data.type === "batch_start") {
                    console.log(`ë°°ì¹˜ ì‘ì—… ì‹œì‘: ì´ ${data.total_files}ê°œ íŒŒì¼`);
                    isProcessing = true;
                    updateUIState();
                    document.getElementById("batch-status").textContent = `ì²˜ë¦¬ ì‹œì‘: ì´ ${data.total_files}ê°œ íŒŒì¼...`;
                    document.getElementById("completed-files").innerHTML = '';

                } else if (data.type === "batch_complete" || data.type === "batch_cancelled") {
                     const statusMsg = data.type === "batch_complete" ? "ì™„ë£Œ" : "ì·¨ì†Œ/ì¢…ë£Œ";
                    console.log(`ë°°ì¹˜ ì‘ì—… ${statusMsg}: ì™„ë£Œ ${data.completed_count}, ê±´ë„ˆëœ€ ${data.skipped_count}, ì˜¤ë¥˜ ${data.error_count}, ì·¨ì†Œ ${data.cancelled_count}`);
                    isProcessing = false;
                    updateUIState();
                    document.getElementById("batch-status").textContent =
                        `ì‘ì—… ${statusMsg}: ì´ ${data.total_files}ê°œ ì¤‘ ` +
                        `ì™„ë£Œ ${data.completed_count}, ê±´ë„ˆëœ€ ${data.skipped_count}, ì˜¤ë¥˜ ${data.error_count}, ì·¨ì†Œ ${data.cancelled_count}.`;

                     document.querySelectorAll('#file-list tr').forEach(row => {
                         const checkbox = row.querySelector('.file-checkbox');
                         if (!row.className.includes('status-completed') &&
                             !row.className.includes('status-skipped') &&
                             !row.className.includes('status-error') &&
                             !row.className.includes('status-cancelled')) {
                             checkbox.disabled = false;
                         }
                     });
                } else if (data.type === "stop_acknowledged") {
                    console.log("ì„œë²„ì—ì„œ ì¤‘ì§€ ìš”ì²­ í™•ì¸ë¨.");
                    document.getElementById("batch-status").textContent = "ì²˜ë¦¬ ì¤‘ì§€ ìš”ì²­ë¨...";
                }

            } catch (error) {
                console.error("WebSocket ë©”ì‹œì§€ ì²˜ë¦¬ ì˜¤ë¥˜:", error, "ì›ë³¸ ë©”ì‹œì§€:", message);
            }
        }

        function findRowByPath(filePath) {
            if (!filePath) return null;
            return document.querySelector(`tr[data-path="${filePath.replace(/"/g, '\\"')}"]`);
        }

        function updateUIState() {
            const runButton = document.getElementById('run-whisper');
            const stopButton = document.getElementById('stop-whisper');
            const checkboxes = document.querySelectorAll('.file-checkbox, #select-all-header');
            const modelSelect = document.getElementById('model-select');

            if (isProcessing) {
                 runButton.disabled = true;
                 stopButton.style.display = 'inline-block';
                 checkboxes.forEach(cb => cb.disabled = true);
                 modelSelect.disabled = true;
                 document.querySelectorAll('button').forEach(btn => {
                     if(btn.id !== 'stop-whisper') btn.disabled = true;
                 });

            } else {
                 runButton.disabled = false;
                 stopButton.style.display = 'none';
                 document.querySelectorAll('#file-list tr').forEach(row => {
                     const checkbox = row.querySelector('.file-checkbox');
                     if (checkbox && !row.className.includes('status-completed') &&
                         !row.className.includes('status-skipped') &&
                         !row.className.includes('status-error') &&
                         !row.className.includes('status-cancelled')) {
                         checkbox.disabled = false;
                     }
                 });
                 if (document.getElementById('select-all-header')) {
                     document.getElementById('select-all-header').disabled = false;
                 }
                 if (modelSelect) {
                     modelSelect.disabled = false;
                 }
                 document.querySelectorAll('button').forEach(btn => {
                     if (btn) btn.disabled = false;
                 });
            }
        }

        // íŠ¸ë¦¬ íƒìƒ‰ ê´€ë ¨ í•¨ìˆ˜ (íƒìƒ‰ê¸° ì˜ì—­)
        /**
         * ë””ë ‰í† ë¦¬ íŠ¸ë¦¬(í´ë” ëª©ë¡) ë¡œë“œ ë° í‘œì‹œ
         * @param {string} relativePath - í˜„ì¬ ìƒëŒ€ ê²½ë¡œ
         */
        async function loadFileTree(relativePath) {
            console.log(`Loading file tree for: ${relativePath}`);
            // ë””ë ‰í† ë¦¬ íŠ¸ë¦¬ ì˜ì—­ ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
            const dirList = document.getElementById('directory-list');
            if (!dirList) {
                console.warn('directory-list DOM ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            dirList.innerHTML = '<li>í´ë” íŠ¸ë¦¬ ë¡œë”© ì¤‘...</li>';

            try {
                const response = await fetch(`/browse?current_path=${encodeURIComponent(relativePath || "")}`);
                if (!response.ok) {
                    throw new Error(`í´ë” íŠ¸ë¦¬ ë¡œë“œ ì‹¤íŒ¨: ${response.statusText}`);
                }
                const data = await response.json();
                if (data.error) {
                    throw new Error(`í´ë” íŠ¸ë¦¬ ì˜¤ë¥˜: ${data.error}`);
                }
                dirList.innerHTML = '';

                // ìƒìœ„ í´ë” ë§í¬ ì¶”ê°€
                if (data.parent_path !== null && data.parent_path !== undefined && 
                    data.parent_path !== relativePath && relativePath !== "") {
                    const parentLi = document.createElement('li');
                    const parentLink = document.createElement('a');
                    parentLink.href = '#';
                    parentLink.className = 'parent-node';
                    parentLink.textContent = '.. (ìƒìœ„ í´ë”)';
                    parentLink.onclick = (e) => {
                        e.preventDefault();
                        navigateTo(data.parent_path);
                    };
                    parentLi.appendChild(parentLink);
                    dirList.appendChild(parentLi);
                }

                // í•˜ìœ„ ë””ë ‰í† ë¦¬ ëª©ë¡ í‘œì‹œ
                if (data.directories && data.directories.length > 0) {
                    console.log(`Found ${data.directories.length} subdirectories.`);
                    data.directories.forEach(dir => {
                        const li = document.createElement('li');
                        const link = document.createElement('a');
                        link.href = '#';
                        // í´ë”ëª… ì˜†ì— (ì˜ìƒ #, ì˜¤ë””ì˜¤ #) í‘œì‹œ (ë°ì´í„°ê°€ ì—†ìœ¼ë©´ 0)
                        const videoCount = typeof dir.video_count === 'number' ? dir.video_count : 0;
                        const audioCount = typeof dir.audio_count === 'number' ? dir.audio_count : 0;
                        link.textContent = `ğŸ“ ${dir.name} (ì˜ìƒ ${videoCount}, ì˜¤ë””ì˜¤ ${audioCount})`;
                        link.onclick = (e) => {
                            e.preventDefault();
                            navigateTo(dir.path);
                        };
                        li.appendChild(link);
                        dirList.appendChild(li);
                    });
                } else if (dirList.children.length === 0) {
                    dirList.innerHTML = '<li><span class="empty-node">í•˜ìœ„ í´ë”ê°€ ì—†ìŠµë‹ˆë‹¤</span></li>';
                }
            } catch (error) {
                console.error("í´ë” íŠ¸ë¦¬ ë¡œë“œ ì¤‘ ì˜¤ë¥˜:", error);
                dirList.innerHTML = `<li>íƒìƒ‰ê¸° ë¡œë“œ ì‹¤íŒ¨: ${error.message}</li>`;
            }
        }

        /**
         * í´ë” ì´ë™ ë° íŒŒì¼ ëª©ë¡ ì•ˆë‚´ ë©”ì‹œì§€ í‘œì‹œ
         * @param {string} relativePath - ì´ë™í•  ê²½ë¡œ
         */
        async function navigateTo(relativePath) {
            console.log(`Navigating to: ${relativePath}`);
            currentRelativePath = relativePath || "";  // ë¹ˆ ë¬¸ìì—´ ì²˜ë¦¬
            // URL ì—…ë°ì´íŠ¸ (íŒŒì¼ í•„í„°ëŠ” ì œì™¸, ê²½ë¡œë§Œ ë³€ê²½)
            const url = `/?scan_path=${encodeURIComponent(relativePath)}`;
            history.pushState({ path: relativePath }, '', url);
            // UI ì—…ë°ì´íŠ¸ (í˜„ì¬ ê²½ë¡œ í‘œì‹œ)
            const pathDisplay = document.getElementById('current-path-display');
            if (pathDisplay) {
                pathDisplay.textContent = `í˜„ì¬ ê²½ë¡œ: /${relativePath || ''}`;
            }
            const fileListHeader = document.getElementById('file-list-header');
            if (fileListHeader) {
                fileListHeader.textContent = 
                    `ìë§‰ ì—†ëŠ” ë¯¸ë””ì–´ íŒŒì¼ ëª©ë¡ (${relativePath ? '/' + relativePath : 'ë£¨íŠ¸'})`;
            }
            try {
                // íŠ¸ë¦¬ êµ¬ì¡° ë¡œë“œ
                await loadFileTree(relativePath);
                // íŒŒì¼ ëª©ë¡ì€ ë¡œë“œí•˜ì§€ ì•Šê³  ì•ˆë‚´ ë©”ì‹œì§€ë§Œ í‘œì‹œ
                const fileListBody = document.getElementById('file-list');
                if (fileListBody) {
                    fileListBody.innerHTML = '<tr><td colspan="6">ì´ í´ë”ì˜ ë¯¸ë””ì–´ íŒŒì¼ì„ ê²€ìƒ‰í•˜ë ¤ë©´ "í˜„ì¬ í´ë” ê²€ìƒ‰" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</td></tr>';
                }
            } catch (error) {
                console.error("íƒìƒ‰ ì˜¤ë¥˜:", error);
                alert(`ê²½ë¡œ íƒìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
            }
        }

        async function scanCurrentDirectory() {
            console.log(`Scanning current directory: ${currentRelativePath}`);
            document.getElementById("batch-status").textContent = "íŒŒì¼ ê²€ìƒ‰ ì¤‘...";
            try {
                await loadFileList(currentRelativePath);
                // document.getElementById("batch-status").textContent = "íŒŒì¼ ê²€ìƒ‰ ì™„ë£Œ"; // ìƒì„¸ ìš”ì•½ì´ ìœ ì§€ë˜ë„ë¡ ì£¼ì„ ì²˜ë¦¬
            } catch (error) {
                console.error("íŒŒì¼ ìŠ¤ìº” ì˜¤ë¥˜:", error);
                document.getElementById("batch-status").textContent = `íŒŒì¼ ê²€ìƒ‰ ì˜¤ë¥˜: ${error.message}`;
                alert(`íŒŒì¼ ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
            }
        }

        async function loadFileList(relativePath) {
            console.log(`Loading file list for: ${relativePath || "root"}`);
            const fileListBody = document.getElementById('file-list');
            if (fileListBody) {
                fileListBody.innerHTML = '<tr><td colspan="6">íŒŒì¼ ëª©ë¡ ë¡œë”© ì¤‘...</td></tr>';
            }

            const filterVideo = document.getElementById('filter-video').checked;
            const filterAudio = document.getElementById('filter-audio').checked;
            const subtitleFilter = document.getElementById('subtitle-filter').value;

            try {
                const response = await fetch(`/api/files?scan_path=${encodeURIComponent(relativePath || "")}&filter_video=${filterVideo}&filter_audio=${filterAudio}&subtitle_filter=${subtitleFilter}`);
                if (!response.ok) {
                    throw new Error(`íŒŒì¼ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨: ${response.statusText}`);
                }
                const data = await response.json();
                // ì˜¤ë¥˜ ì²˜ë¦¬
                if (data.error) {
                    throw new Error(`íŒŒì¼ ëª©ë¡ ì˜¤ë¥˜: ${data.error}`);
                }
                if (fileListBody) {
                    fileListBody.innerHTML = '';
                }

                // ê²€ìƒ‰ ê²°ê³¼ í†µê³„ ê³„ì‚°
                let total = 0, video = 0, audio = 0, noSubtitle = 0, hasSubtitle = 0;
                if (data.files && data.files.length > 0) {
                    data.files.forEach(file => {
                        total++;
                        if (file.type === 'video') video++;
                        if (file.type === 'audio') audio++;
                        if (file.has_subtitle) hasSubtitle++;
                        else noSubtitle++;
                        if (!fileListBody) return;
                        const row = document.createElement('tr');
                        row.dataset.path = file.path;
                        row.dataset.type = file.type;
                        row.innerHTML = `
                            <td><input type="checkbox" class="file-checkbox"></td>
                            <td class="status" style="cursor:pointer;">ëŒ€ê¸°</td>
                            <td class="progress">-</td>
                            <td class="filename">${escapeHtml(file.name)}</td>
                            <td class="lang-code">${file.language || '-'}</td>
                            <td class="subtitle-preview" title="ìë§‰ ë¯¸ë¦¬ë³´ê¸° í´ë¦­">-</td>
                        `;
                        fileListBody.appendChild(row);
                    });
                } else {
                    if (fileListBody) {
                        fileListBody.innerHTML = '<tr><td colspan="6">ìë§‰ ì—†ëŠ” íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                    }
                }
                // í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ í•„í„°ë§ ì ìš©
                filterTableClientSide();

                // ìƒíƒœ/ìë§‰ ë¯¸ë¦¬ë³´ê¸° í´ë¦­ ì´ë²¤íŠ¸ ë°”ì¸ë”©
                document.querySelectorAll('#file-list .status').forEach(cell => {
                    cell.onclick = function() {
                        const row = cell.closest('tr');
                        if (!row) return;
                        const filePath = row.dataset.path;
                        // ìƒì„¸ ì‘ì—… ìƒí™© ëª¨ë‹¬ í‘œì‹œ
                        showProgressModal(filePath);
                    };
                });
                document.querySelectorAll('#file-list .subtitle-preview').forEach(cell => {
                    cell.onclick = function() {
                        const row = cell.closest('tr');
                        if (!row) return;
                        const subtitle = cell.innerText || '-';
                        showSubtitleModal(subtitle, row.querySelector('.filename')?.innerText || '');
                    };
                });

                // ê²€ìƒ‰ ê²°ê³¼ ìƒì„¸ í‘œì‹œ
                const batchStatus = document.getElementById('batch-status');
                if (batchStatus) {
                    batchStatus.innerHTML = `
                        <div style="background:#f4f8ff;padding:10px;border-radius:6px;margin:8px 0;">
                            <b>ê²€ìƒ‰ ê²°ê³¼ ìš”ì•½</b><br>
                            ì´ <b>${total}</b>ê°œ íŒŒì¼ (ì˜ìƒ <b>${video}</b>, ì˜¤ë””ì˜¤ <b>${audio}</b>)<br>
                            ìë§‰ ì—†ëŠ” íŒŒì¼: <b>${noSubtitle}</b>ê°œ, ìë§‰ ìˆëŠ” íŒŒì¼: <b>${hasSubtitle}</b>ê°œ
                        </div>
                    `;
                }
            } catch (error) {
                console.error("íŒŒì¼ ëª©ë¡ ë¡œë“œ ì¤‘ ì˜¤ë¥˜:", error);
                if (fileListBody) {
                    fileListBody.innerHTML = `<tr><td colspan="6">íŒŒì¼ ëª©ë¡ ë¡œë“œ ì¤‘ ì˜¤ë¥˜: ${error.message}</td></tr>`;
                }
                const batchStatus = document.getElementById('batch-status');
                if (batchStatus) {
                    batchStatus.textContent = `íŒŒì¼ ê²€ìƒ‰ ì˜¤ë¥˜: ${error.message}`;
                }
            }
        }

        function filterTableClientSide() {
            const filterVideo = document.getElementById('filter-video').checked;
            const filterAudio = document.getElementById('filter-audio').checked;
            const searchQuery = document.getElementById('file-search').value.toLowerCase();
            const rows = document.querySelectorAll('#file-list tr');
            let visibleCount = 0;

            rows.forEach(row => {
                const fileType = row.dataset.type;
                const fileName = row.querySelector('.filename').textContent.toLowerCase();
                let showRow = false;

                if (fileType === 'video' && filterVideo) {
                    showRow = true;
                }
                if (fileType === 'audio' && filterAudio) {
                    showRow = true;
                }
                if (searchQuery && !fileName.includes(searchQuery)) {
                    showRow = false;
                }

                row.style.display = showRow ? '' : 'none';
                if (showRow) visibleCount++;
            });
            
            // ì•„ë¬´ê²ƒë„ í‘œì‹œë˜ì§€ ì•ŠëŠ” ê²½ìš° ë©”ì‹œì§€ í‘œì‹œ
            if (visibleCount === 0 && rows.length > 0) {
                const fileListBody = document.getElementById('file-list');
                fileListBody.innerHTML += `<tr><td colspan="6">ì„ íƒí•œ í•„í„°ì— í•´ë‹¹í•˜ëŠ” íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
            }
        }

        // ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ë° ì´ˆê¸°í™”
        window.onload = () => {
            // WebSocket ì—°ê²°
            connectWebSocket();
            
            // ì´ˆê¸° ë””ë ‰í† ë¦¬ ë° íŒŒì¼ ëª©ë¡ ë¡œë“œ
            navigateTo(currentRelativePath);

            // Whisper ìë§‰ ìƒì„±ê¸° íƒ€ì´í‹€ í´ë¦­ ì‹œ í™ˆìœ¼ë¡œ ì´ë™ ë° UI ì´ˆê¸°í™”
            const appTitle = document.getElementById('app-title');
            if (appTitle) {
                appTitle.onclick = function() {
                    // ì£¼ì†Œë¥¼ í™ˆìœ¼ë¡œ ì´ë™
                    window.history.pushState({}, '', '/');
                    // ê²½ë¡œ ë° UI ìƒíƒœ ì´ˆê¸°í™”
                    currentRelativePath = '';
                    navigateTo('');
                    // ì²´í¬ë°•ìŠ¤, í•„í„°, ê²€ìƒ‰ì–´, ì§„í–‰ìƒíƒœ ë“± ëª¨ë‘ ì´ˆê¸°í™”
                    document.getElementById('file-search').value = '';
                    document.getElementById('filter-video').checked = true;
                    document.getElementById('filter-audio').checked = true;
                    document.getElementById('subtitle-filter').value = 'no_subtitle';
                    document.getElementById('model-select').value = 'base';
                    document.getElementById('whisper-lang').value = 'auto';
                    document.getElementById('batch-status').textContent = '';
                    // íŒŒì¼ ëª©ë¡, ì™„ë£Œ ëª©ë¡, ì‘ì—… í˜„í™© ë“±ë„ ì´ˆê¸°í™”
                    const fileListBody = document.getElementById('file-list');
                    if (fileListBody) fileListBody.innerHTML = '<tr><td colspan="6">ìë§‰ ì—†ëŠ” íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                    const completedFiles = document.getElementById('completed-files');
                    if (completedFiles) completedFiles.innerHTML = '';
                    const jobList = document.getElementById('job-list');
                    if (jobList) jobList.innerHTML = '<li style="color:#888;">ì§„í–‰ ì¤‘ì¸ ì‘ì—…ì´ ì—†ìŠµë‹ˆë‹¤.</li>';
                };
            }

            // ì²´í¬ë°•ìŠ¤ ê´€ë ¨ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
            const selectAllHeader = document.getElementById('select-all-header');
            
            selectAllHeader.addEventListener('change', (event) => {
                document.querySelectorAll('#file-list .file-checkbox').forEach(checkbox => {
                    if (!checkbox.disabled && !checkbox.closest('tr').style.display === 'none') {
                        checkbox.checked = event.target.checked;
                    }
                });
            });

            document.getElementById('select-all').addEventListener('click', () => {
                document.querySelectorAll('#file-list .file-checkbox').forEach(checkbox => {
                    if (!checkbox.disabled && checkbox.closest('tr').style.display !== 'none') {
                        checkbox.checked = true;
                    }
                });
                selectAllHeader.checked = true;
            });
            
            document.getElementById('deselect-all').addEventListener('click', () => {
                document.querySelectorAll('#file-list .file-checkbox').forEach(checkbox => {
                    checkbox.checked = false;
                });
                selectAllHeader.checked = false;
            });

            // Whisper ì‹¤í–‰ ë²„íŠ¼ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
            document.getElementById('run-whisper').addEventListener('click', async () => {
                const selectedFiles = [];
                document.querySelectorAll('#file-list .file-checkbox:checked').forEach(checkbox => {
                    if (checkbox.closest('tr').style.display !== 'none') {
                        selectedFiles.push(checkbox.closest('tr').dataset.path);
                    }
                });

                if (selectedFiles.length === 0) {
                    alert('ìë§‰ì„ ìƒì„±í•  íŒŒì¼ì„ í•˜ë‚˜ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return;
                }

                const modelSize = document.getElementById('model-select').value;
                const language = document.getElementById('whisper-lang').value;
                document.getElementById("batch-status").textContent = "ì„œë²„ì— ì²˜ë¦¬ ìš”ì²­ ì¤‘...";
                
                try {
                    const response = await fetch('/run-whisper', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ 
                            files: selectedFiles, 
                            client_id: clientId, 
                            model_size: modelSize,
                            language: language
                        }),
                    });
                    
                    const result = await response.json();
                    
                    if (response.ok) {
                        console.log("Whisper ì‘ì—… ì‹œì‘ë¨:", result);
                        document.getElementById("batch-status").textContent = result.message;
                    } else {
                        console.error("Whisper ì‘ì—… ì‹œì‘ ì‹¤íŒ¨:", result);
                        document.getElementById("batch-status").textContent = `ì˜¤ë¥˜: ${result.detail || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`;
                        alert(`ì˜¤ë¥˜: ${result.detail || 'Whisper ì‘ì—… ì‹œì‘ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'}`);
                        isProcessing = false;
                        updateUIState();
                    }
                } catch (error) {
                    console.error('Whisper ìš”ì²­ ì¤‘ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜:', error);
                    document.getElementById("batch-status").textContent = "ì˜¤ë¥˜: ì„œë²„ ì—°ê²° ì‹¤íŒ¨";
                    alert('ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    isProcessing = false;
                    updateUIState();
                }
            });

            // ì¤‘ì§€ ë²„íŠ¼ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
            document.getElementById('stop-whisper').addEventListener('click', () => {
                if (websocket && websocket.readyState === WebSocket.OPEN) {
                    console.log("Whisper ì²˜ë¦¬ ì¤‘ì§€ ìš”ì²­ ì „ì†¡");
                    websocket.send(JSON.stringify({ type: 'stop_processing' }));
                } else {
                    console.warn("WebSocketì´ ì—°ê²°ë˜ì§€ ì•Šì•„ ì¤‘ì§€ ìš”ì²­ì„ ë³´ë‚¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                    alert("ì„œë²„ì™€ì˜ ì—°ê²°ì´ ëŠì–´ì¡ŒìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ ì£¼ì„¸ìš”.");
                }
            });

            // ìŠ¤ìº” ë²„íŠ¼ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
            document.getElementById('scan-directory').addEventListener('click', () => {
                scanCurrentDirectory();
            });

            // ê²€ìƒ‰ í•„í„° ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
            document.getElementById('file-search').addEventListener('input', () => {
                filterTableClientSide();
            });

            // ë¸Œë¼ìš°ì € ë‚´ë¹„ê²Œì´ì…˜ ì´ë²¤íŠ¸ ì²˜ë¦¬ (ë’¤ë¡œê°€ê¸°/ì•ìœ¼ë¡œê°€ê¸°)
            window.onpopstate = (event) => {
                if (event.state && event.state.path !== undefined) {
                    console.log("History popstate event:", event.state.path);
                    currentRelativePath = event.state.path;
                    loadFileTree(currentRelativePath);
                    loadFileList(currentRelativePath);
                } else {
                    const params = new URLSearchParams(window.location.search);
                    const pathFromUrl = params.get('scan_path') || '';
                    console.log("History popstate event (no state): path from URL=", pathFromUrl);
                    if (pathFromUrl !== currentRelativePath) {
                        currentRelativePath = pathFromUrl;
                        loadFileTree(currentRelativePath);
                        loadFileList(currentRelativePath);
                    }
                }
            };

            // ìƒ˜í”Œ ì‘ì—… í˜„í™© ë Œë”ë§
            renderJobList([
                { filename: 'Boyhood.mp4', progress: 30, status: 'ì§„í–‰ì¤‘', language: 'en', model: 'small' },
                { filename: 'Elemental.mp3', progress: 0, status: 'ëŒ€ê¸°', language: 'ko', model: 'base' },
                { filename: 'Hercules.mp4', progress: 100, status: 'ì™„ë£Œ', language: 'en', model: 'small' }
            ]);
        };

        // ëª¨ë‹¬ì°½ ê´€ë ¨ í•¨ìˆ˜
        function showProgressModal(filePath) {
            // ëª¨ë‹¬ ìš”ì†Œê°€ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
            const modal = document.getElementById('progress-modal');
            const filePathElem = document.getElementById('modal-file-path');
            const logElem = document.getElementById('modal-progress-log');
            if (!modal || !filePathElem || !logElem) {
                console.warn('ëª¨ë‹¬ ê´€ë ¨ DOM ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            modal.style.display = 'block';
            filePathElem.textContent = filePath;
            logElem.textContent = 'ì§„í–‰ìƒíƒœ/ë¡œê·¸ë¥¼ ì—¬ê¸°ì— í‘œì‹œ';
        }
        // ìë§‰ ë¯¸ë¦¬ë³´ê¸° ëª¨ë‹¬ í•¨ìˆ˜
        function showSubtitleModal(subtitle, filename) {
            const modal = document.getElementById('progress-modal');
            const filePathElem = document.getElementById('modal-file-path');
            const logElem = document.getElementById('modal-progress-log');
            if (!modal || !filePathElem || !logElem) {
                console.warn('ëª¨ë‹¬ ê´€ë ¨ DOM ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            modal.style.display = 'block';
            filePathElem.textContent = filename + ' - ìë§‰ ë¯¸ë¦¬ë³´ê¸°';
            logElem.innerHTML = `<pre style="white-space: pre-wrap;">${escapeHtml(subtitle)}</pre>`;
        }
        // ëª¨ë‹¬ ë‹«ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ (null ì²´í¬ ì¶”ê°€)
        const modalCloseBtn = document.getElementById('modal-close');
        if (modalCloseBtn) {
            modalCloseBtn.onclick = function() {
                const modal = document.getElementById('progress-modal');
                if (modal) modal.style.display = 'none';
            };
        }
        // ëª¨ë‹¬ ë°”ê¹¥ í´ë¦­ ì‹œ ë‹«ê¸° (null ì²´í¬ ì¶”ê°€)
        window.onclick = function(event) {
            const modal = document.getElementById('progress-modal');
            if (modal && event.target === modal) {
                modal.style.display = 'none';
            }
        };

        // Whisper ì‘ì—… ëª©ë¡ì„ ì„œë²„ì—ì„œ ë°›ì•„ì™€ ë Œë”ë§
        async function fetchAndRenderJobs() {
            try {
                const res = await fetch('/api/jobs');
                const data = await res.json();
                if (data.jobs) {
                    renderJobList(data.jobs);
                } else {
                    renderJobList([]);
                }
            } catch (e) {
                renderJobList([]);
            }
        }

        // ë²„íŠ¼ í´ë¦­ ì‹œ ì„œë²„ì— ëª…ë ¹ ì „ì†¡
        async function sendJobAction(jobId, action) {
            try {
                await fetch(`/api/job/${jobId}/action`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action })
                });
                // ìƒíƒœ ê°±ì‹ 
                fetchAndRenderJobs();
            } catch (e) {
                alert('ì‘ì—… ëª…ë ¹ ì „ì†¡ ì‹¤íŒ¨');
            }
        }

        // ì‘ì—… í˜„í™© ë Œë”ë§ (ì‹¤ì œ ë°ì´í„° ê¸°ë°˜)
        function renderJobList(jobs) {
            const jobList = document.getElementById('job-list');
            if (!jobList) return;
            jobList.innerHTML = '';
            if (!jobs || jobs.length === 0) {
                jobList.innerHTML = '<li style="color:#888;">ì§„í–‰ ì¤‘ì¸ ì‘ì—…ì´ ì—†ìŠµë‹ˆë‹¤.</li>';
                return;
            }
            // ì§„í–‰ì¤‘/ì¼ì‹œì •ì§€ ìƒíƒœ 1ê°œë§Œ ì²« ì¤„, ë‚˜ë¨¸ì§€ëŠ” ì•„ë˜
            let mainJob = jobs.find(j => j.status === 'ì§„í–‰ì¤‘' || j.status === 'ì¼ì‹œì •ì§€') || jobs[0];
            let otherJobs = jobs.filter(j => j !== mainJob);
            // ë©”ì¸ ì‘ì—…(2ì¤„)
            if (mainJob) {
                const li = document.createElement('li');
                li.style.display = 'block';
                li.style.marginBottom = '10px';
                li.innerHTML = `
                  <div style="font-weight:500;font-size:1em;">
                    <span class="job-filename" style="cursor:pointer;color:#1a5dab;" title="ìƒì„¸ ë³´ê¸°">${mainJob.filename} <span style='color:#888;font-weight:400;font-size:0.97em;'>(${mainJob.language}, ${mainJob.model})</span></span>
                  </div>
                  <div style="margin-top:2px;display:flex;align-items:center;gap:4px;">
                    <span style="width:54px;">${mainJob.progress}%</span>
                    <span style="color:#888;">${mainJob.status}</span>
                    <button class="job-btn" data-action="pause" title="ì¼ì‹œì •ì§€">â¸ï¸</button>
                    <button class="job-btn" data-action="stop" title="ì¤‘ë‹¨">ğŸ›‘</button>
                    <button class="job-btn" data-action="resume" title="ì¬ê°œ">â–¶ï¸</button>
                    <button class="job-btn job-delete" data-action="delete" title="ì‚­ì œ">âŒ</button>
                  </div>
                `;
                li.querySelector('.job-filename').onclick = function() {
                    showProgressModal(mainJob.filename);
                };
                // ìƒíƒœë³„ ë²„íŠ¼ í™œì„±/ë¹„í™œì„±
                li.querySelector('[data-action="pause"]').disabled = mainJob.status !== 'ì§„í–‰ì¤‘';
                li.querySelector('[data-action="stop"]').disabled = mainJob.status === 'ì™„ë£Œ' || mainJob.status === 'ì¤‘ë‹¨ë¨';
                li.querySelector('[data-action="resume"]').disabled = mainJob.status !== 'ì¼ì‹œì •ì§€';
                // ë²„íŠ¼ ì´ë²¤íŠ¸
                li.querySelector('[data-action="pause"]').onclick = function() {
                    sendJobAction(mainJob.id, 'pause');
                };
                li.querySelector('[data-action="stop"]').onclick = function() {
                    sendJobAction(mainJob.id, 'stop');
                };
                li.querySelector('[data-action="resume"]').onclick = function() {
                    sendJobAction(mainJob.id, 'resume');
                };
                li.querySelector('.job-delete').onclick = function() {
                    sendJobAction(mainJob.id, 'delete');
                };
                jobList.appendChild(li);
            }
            // ë‚˜ë¨¸ì§€ ì‘ì—…(ì‘ê²Œ, í•œ ì¤„ì— ì—¬ëŸ¬ ê°œ)
            if (otherJobs.length > 0) {
                const li = document.createElement('li');
                li.style.display = 'flex';
                li.style.flexWrap = 'wrap';
                li.style.gap = '8px';
                otherJobs.forEach(job => {
                    const jobBox = document.createElement('span');
                    jobBox.style.display = 'inline-flex';
                    jobBox.style.alignItems = 'center';
                    jobBox.style.background = '#f3f6fa';
                    jobBox.style.borderRadius = '5px';
                    jobBox.style.padding = '2px 6px 2px 4px';
                    jobBox.style.marginBottom = '2px';
                    jobBox.style.fontSize = '0.97em';
                    jobBox.innerHTML = `
                      <span class="job-filename" style="cursor:pointer;color:#1a5dab;" title="ìƒì„¸ ë³´ê¸°">${job.filename} <span style='color:#888;font-weight:400;font-size:0.97em;'>(${job.language}, ${job.model})</span></span>
                      <span style="margin:0 4px 0 6px;color:#888;">${job.status}</span>
                      <button class="job-btn job-delete" data-action="delete" title="ì‚­ì œ">âŒ</button>
                    `;
                    jobBox.querySelector('.job-filename').onclick = function() {
                        showProgressModal(job.filename);
                    };
                    jobBox.querySelector('.job-delete').onclick = function() {
                        sendJobAction(job.id, 'delete');
                    };
                    li.appendChild(jobBox);
                });
                jobList.appendChild(li);
            }
        }

        // 3ì´ˆë§ˆë‹¤ ì‘ì—… ëª©ë¡ í´ë§
        setInterval(fetchAndRenderJobs, 3000);
    </script>
</body>
</html>